name: Course Import Dry-Run

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate-manifest:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests pyyaml

      - name: Dry-run validate sample manifest
        run: |
          python scripts/import_course.py \
            --manifest scripts/ci_course_sample/manifest.yaml \
            --base-url http://127.0.0.1:8000 \
            --email test@example.com \
            --password secret \
            --dry-run \
            --max-size-mb 1

      - name: Dry-run validate all manifests in courses/
        run: |
          bash scripts/validate_courses.sh
