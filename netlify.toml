[build]
  # Deployment invariants (machine-enforced by scripts + CI):
  # - Base directory: frontend
  # - Build command: bash scripts/netlify_build_web.sh
  # - Publish directory: frontend/build/web (publish is relative to base)
  # - Production deploys only from main
  # - Branch deploys are previews only and must never ship production artifacts
  base = "frontend"
  # Flutter Web production builds MUST be configured via Netlify env vars and
  # injected at build time using --dart-define (compiled into the app).
  #
  # Required Netlify env vars:
  # - FLUTTER_API_BASE_URL
  # - FLUTTER_SUPABASE_URL
  # - FLUTTER_SUPABASE_PUBLIC_API_KEY
  # - FLUTTER_STRIPE_PUBLISHABLE_KEY
  # - FLUTTER_OAUTH_REDIRECT_WEB
  #
  # The build will fail fast if any are missing.
  command = "bash scripts/netlify_build_web.sh"
  publish = "build/web"

# Back-compat for older manifests / cached icon references.
[[redirects]]
  from = "/icons/Icon-192.png"
  to = "/icons/icon-192.png"
  status = 301

[[redirects]]
  from = "/icons/Icon-512.png"
  to = "/icons/icon-512.png"
  status = 301

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[[headers]]
  for = "/index.html"
  [headers.values]
    Cache-Control = "no-cache, no-store, must-revalidate"

[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "no-cache"

[[headers]]
  for = "/version.json"
  [headers.values]
    Cache-Control = "no-cache, no-store, must-revalidate"

[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "no-cache"

[[headers]]
  for = "/canvaskit/*"
  [headers.values]
    Cache-Control = "no-cache"

[[headers]]
  for = "/flutter_service_worker.js"
  [headers.values]
    Cache-Control = "no-store"
